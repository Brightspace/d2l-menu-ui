<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="d2l-menu-item-styles.html">
<link rel="import" href="d2l-menu-item-behavior.html">
<link rel="import" href="../d2l-icons/d2l-icon.html">
<link rel="import" href="../d2l-icons/tier1-icons.html">

<!--
`d2l-menu-item-link`
Polymer-based web component for link menu items.
-->

<dom-module id="d2l-menu-item-link">

	<template>
		<style include="d2l-menu-item-styles">

			:host {
				display: block;
				padding: 0;
			}

			:host > a {
				color: inherit;
				display: flex;
				justify-content: space-between;
				align-items: center;
				line-height: 1rem;
				outline: none;
				text-decoration: none;
				white-space: nowrap;
				padding: 0.75rem 1rem;
			}

			:host > a > .main {
				display: flex;
				align-items: center;
				overflow: hidden;
			}

			:host > a > .main > span {
				overflow-x: hidden;
				text-overflow: ellipsis;
			}

			:host > a > .main > d2l-icon {
				padding-right: 10px;
				flex-shrink: 0;
			}

			:host(:hover) a > .main > d2l-icon,
			:host(:focus) a > .main > d2l-icon {
				color: var(--d2l-color-celestine);
			}

			:host-context([dir="rtl"]) :host > a > .main > d2l-icon {
				padding-right: 0;
				padding-left: 10px;
			}

			:host > a > .main > d2l-icon:not([icon]) {
				display: none;
			}
		</style>

		<a href$="[[href]]" target$=[[target]] tabindex="-1">
			<div class="main">
				<d2l-icon icon$=[[icon]]></d2l-icon>
				<span>[[text]]</span>
			</div>
			<slot></slot>
		</a>
	</template>

	<script>
		Polymer({
			is: 'd2l-menu-item-link',

			behaviors: [
				D2L.PolymerBehaviors.MenuItemBehavior
			],

			properties: {

				/**
				 * Standard HTML href applied to link.
				 */
				href: String,

				/**
				 * Whether to prevent the default behavior.
				 */
				preventDefault: {
					type: Boolean,
					reflectToAttribute: true
				},

				/**
				 * Standard HTML target applied to link.
				 */
				target: String,

				/**
				 * Icon to appear beside text
				 */
				icon: String

			},

			attached: function() {
				Polymer.RenderStatus.afterNextRender(this, function() {
					this.listen(this, 'keydown', '_onKeyDown');
					this.listen(this.$$('a'), 'click', '_onClick');
				}.bind(this));
			},

			detached: function() {
				this.unlisten(this, 'keydown', '_onKeyDown');
				this.unlisten(this.$$('a'), 'click', '_onClick');
			},

			_getTarget: function() {
				if (this.target && this.target !== '') {
					return this.target;
				}
				var base = document.getElementsByTagName('base');
				if (base && base.length > 0) {
					base = base[0];
					return base.getAttribute('target');
				}
				return null;
			},

			_onClick: function(e) {
				if (this.preventDefault) {
					e.preventDefault();
				}
			},

			_onKeyDown: function(e) {
				if (this.preventDefault) {
					e.preventDefault();
					return;
				}
				if (e.keyCode === this.__keyCodes.ENTER || e.keyCode === this.__keyCodes.SPACE) {
					var target = this._getTarget();
					if (target === '_parent') {
						window.parent.location.assign(this.href);
					} else if (target === '_top') {
						window.top.location.assign(this.href);
					} else {
						window.location.assign(this.href);
					}
				}
			}

		});
	</script>

</dom-module>
